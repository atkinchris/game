{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/mapToEntities.js","webpack:///./src/utils/randomColour.js","webpack:///./src/types/region.js","webpack:///./src/types/zone.js","webpack:///./src/types/world.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","map","entities","y","length","row","x","cell","push","blocked","Math","floor","random","_randomColour","Region","id","_classCallCheck","this","colour","_randomColour2","default","entity","_region","ZONE_SIZE","Zone","worldX","worldY","String","padStart","cells","regions","addEntity","rebuild","height","width","localPosition","toLocalPos","hash","toIndex","regionId","values","region","node","getEntity","flood","lastRegionId","_this","getNextFree","getEntities","findIndex","resetRegions","next","_region2","position","toPosition","_ref","index","_ref2","_zone","World","zones","dirtyZones","zone","_zone2","getZone","zX","zY","console","log","addZone","regionHash","_regionHash$split","split","zoneId","_slicedToArray","find","z","getRegion","canvas","document","getElementById","context","getContext","translate","world","_world2","_mapToEntities2","_map2","forEach","render","clearRect","rebuildDirtyZones","getZones","zoneIndex","concat","entityIndex","fillStyle","fillRect","_zones$_zoneIndex$get","getBounds","strokeStyle","lineWidth","rect","stroke","onclick","event","getBoundingClientRect","_toWorldCoordinates","toWorldCoordinates","clientX","left","clientY","top","touch"],"mappings":"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","file":"main.487207e5.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","const mapToEntities = (map) => {\n  const entities = []\n\n  for (let y = 0; y < map.length; y += 1) {\n    const row = map[y]\n\n    for (let x = 0; x < row.length; x += 1) {\n      const cell = row[x]\n      entities.push({ x, y, blocked: cell === 1 })\n    }\n  }\n\n  return entities\n}\n\nexport default mapToEntities\n","const randomColour = () => {\n  const h = Math.floor(Math.random() * 255)\n\n  return `hsl(${h}, 100%, 50%)`\n}\n\nexport default randomColour\n","import randomColour from '../utils/randomColour'\n\nclass Region {\n  constructor(id) {\n    this.id = id\n    this.entities = []\n    this.colour = randomColour()\n  }\n\n  addEntity(entity) {\n    this.entities.push(entity)\n  }\n\n  getEntities() {\n    return this.entities\n  }\n}\n\nexport default Region\n","import Region from './region'\n\nexport const ZONE_SIZE = 14\n\nclass Zone {\n  constructor(worldX, worldY) {\n    this.id = `${String(worldX).padStart(4, 0)}${String(worldY).padStart(4, 0)}`\n    this.worldX = worldX\n    this.worldY = worldY\n    this.cells = []\n    this.regions = {}\n\n    for (let y = 0; y < ZONE_SIZE; y += 1) {\n      for (let x = 0; x < ZONE_SIZE; x += 1) {\n        this.addEntity({\n          blocked: false,\n          x: (this.worldX * ZONE_SIZE) + x,\n          y: (this.worldY * ZONE_SIZE) + y,\n        })\n      }\n    }\n\n    this.rebuild()\n  }\n\n  getBounds() {\n    return {\n      x: this.worldX * ZONE_SIZE,\n      y: this.worldY * ZONE_SIZE,\n      height: ZONE_SIZE,\n      width: ZONE_SIZE,\n    }\n  }\n\n  addEntity(entity) {\n    const localPosition = Zone.toLocalPos(entity)\n    const hash = Zone.toIndex(localPosition)\n    this.cells[hash] = entity\n    return entity\n  }\n\n  getEntities() {\n    return this.cells\n  }\n\n  getEntity(x, y) {\n    const localPosition = Zone.toLocalPos({ x, y })\n    return this.cells[Zone.toIndex(localPosition)]\n  }\n\n  getRegion(regionId) {\n    return this.regions[regionId]\n  }\n\n  getRegions() {\n    return Object.values(this.regions)\n  }\n\n  flood(x, y, region) {\n    if (x < 0 || x >= ZONE_SIZE || y < 0 || y >= ZONE_SIZE) {\n      return\n    }\n\n    const node = this.getEntity(x, y)\n    if (!node || node.blocked || node.region) return\n\n    region.addEntity(node)\n    node.region = region\n\n    this.flood(x - 1, y, region)\n    this.flood(x + 1, y, region)\n    this.flood(x, y + 1, region)\n    this.flood(x, y - 1, region)\n  }\n\n  resetRegions() {\n    this.regions = {}\n    this.lastRegionId = 0\n\n    for (let i = 0; i < this.cells.length; i += 1) {\n      this.cells[i].region = null\n    }\n  }\n\n  rebuild() {\n    const getNextFree = () => this.getEntities().findIndex(p => !p.region && !p.blocked)\n\n    this.resetRegions()\n    let next = getNextFree()\n\n    while (next !== -1) {\n      this.lastRegionId += 1\n      const region = new Region(`${this.id}::${this.lastRegionId}`)\n      this.regions[region.id] = region\n\n      const position = Zone.toPosition(next)\n      this.flood(position.x, position.y, region)\n      next = getNextFree()\n    }\n  }\n\n  static toLocalPos({ x, y }) {\n    return {\n      x: x % ZONE_SIZE,\n      y: y % ZONE_SIZE,\n    }\n  }\n\n  static toPosition(index) {\n    return {\n      x: index % ZONE_SIZE,\n      y: Math.floor(index / ZONE_SIZE),\n    }\n  }\n\n  static toIndex({ x, y }) {\n    return (y * ZONE_SIZE) + x\n  }\n}\n\nexport default Zone\n","import Zone, { ZONE_SIZE } from './zone'\n\nclass World {\n  constructor() {\n    this.zones = []\n    this.dirtyZones = []\n  }\n\n  addZone(x, y) {\n    const zone = new Zone(x, y)\n    this.zones.push(zone)\n    return zone\n  }\n\n  addEntity(entity) {\n    let zone = this.getZone(entity.x, entity.y)\n\n    if (!zone) {\n      const zX = Math.floor(entity.x / ZONE_SIZE)\n      const zY = Math.floor(entity.y / ZONE_SIZE)\n      console.log(`Creating zone at {${zX}, ${zY}}`)\n      zone = this.addZone(zX, zY)\n    }\n\n    this.dirtyZones.push(zone)\n\n    return zone.addEntity(entity)\n  }\n\n  getEntity(x, y) {\n    const zone = this.getZone(x, y)\n    return zone ? zone.getEntity(x, y) : null\n  }\n\n  getRegion(regionHash) {\n    const [zoneId] = regionHash.split('::')\n    const zone = this.zones.find(z => z.id === zoneId)\n\n    return zone.getRegion(regionHash)\n  }\n\n  rebuildDirtyZones() {\n    for (let i = 0; i < this.dirtyZones.length; i += 1) {\n      this.dirtyZones[i].rebuild()\n    }\n\n    this.dirtyZones = []\n  }\n\n  getZone(x, y) {\n    const zX = Math.floor(x / ZONE_SIZE)\n    const zY = Math.floor(y / ZONE_SIZE)\n    return this.zones.find(z => z.worldX === zX && z.worldY === zY)\n  }\n\n  getZones() {\n    return this.zones\n  }\n\n  touch(x, y) {\n    const { blocked } = this.getEntity(x, y) || {}\n    this.addEntity({\n      x,\n      y,\n      blocked: !blocked,\n    })\n  }\n}\n\nexport default World\n","import World from './types/world'\nimport mapToEntities from './utils/mapToEntities'\nimport map from './map.json'\n\nconst TILE_SIZE = 16\nconst TRANSLATE = 10\n\nconst canvas = document.getElementById('canvas')\nconst context = canvas.getContext('2d')\ncontext.translate(TRANSLATE, TRANSLATE)\n\nconst world = new World()\nmapToEntities(map).forEach(entity => world.addEntity(entity))\n\nconst render = () => {\n  context.clearRect(0, 0, canvas.width, canvas.height)\n\n  world.rebuildDirtyZones()\n  const zones = world.getZones()\n  let entities = []\n\n  for (let zoneIndex = 0; zoneIndex < zones.length; zoneIndex += 1) {\n    entities = entities.concat(zones[zoneIndex].getEntities())\n  }\n\n  for (let entityIndex = 0; entityIndex < entities.length; entityIndex += 1) {\n    const entity = entities[entityIndex]\n\n    context.fillStyle = entity.blocked ? '#333' : world.getRegion(entity.region.id).colour\n    context.fillRect(entity.x * TILE_SIZE, entity.y * TILE_SIZE, TILE_SIZE, TILE_SIZE)\n  }\n\n  for (let zoneIndex = 0; zoneIndex < zones.length; zoneIndex += 1) {\n    const { x, y, width, height } = zones[zoneIndex].getBounds()\n\n    context.strokeStyle = 'blue'\n    context.lineWidth = '5'\n    context.rect(\n      x * TILE_SIZE,\n      y * TILE_SIZE,\n      width * TILE_SIZE,\n      height * TILE_SIZE,\n    )\n    context.stroke()\n  }\n}\n\nconst toWorldCoordinates = (x, y) => ({\n  x: Math.floor((x - TRANSLATE) / TILE_SIZE),\n  y: Math.floor((y - TRANSLATE) / TILE_SIZE),\n})\n\ncanvas.onclick = (event) => {\n  const rect = canvas.getBoundingClientRect()\n  const { x, y } = toWorldCoordinates(event.clientX - rect.left, event.clientY - rect.top)\n  world.touch(x, y)\n  render()\n}\n\nrender()\n"],"sourceRoot":""}