!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t){t.exports=[[0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){for(var e=[],n=0;n<t.length;n+=1)for(var r=t[n],o=0;o<r.length;o+=1){var i=r[o];e.push({x:o,y:n,blocked:1===i})}return e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(){return"hsl("+Math.floor(255*Math.random())+", 100%, 50%)"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(2),u=(r=i)&&r.__esModule?r:{default:r};var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.entities=[],this.colour=(0,u.default)()}return o(t,[{key:"addEntity",value:function(t){this.entities.push(t)}},{key:"getEntities",value:function(){return this.entities}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ZONE_SIZE=void 0;var r,o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(3),u=(r=i)&&r.__esModule?r:{default:r};var a=e.ZONE_SIZE=14,l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=""+String(e).padStart(4,0)+String(n).padStart(4,0),this.worldX=e,this.worldY=n,this.cells=[],this.regions={};for(var r=0;r<a;r+=1)for(var o=0;o<a;o+=1)this.addEntity({blocked:!1,x:this.worldX*a+o,y:this.worldY*a+r});this.rebuild()}return o(t,[{key:"getBounds",value:function(){return{x:this.worldX*a,y:this.worldY*a,height:a,width:a}}},{key:"addEntity",value:function(e){var n=t.toLocalPos(e),r=t.toIndex(n);return this.cells[r]=e,e}},{key:"getEntities",value:function(){return this.cells}},{key:"getEntity",value:function(e,n){var r=t.toLocalPos({x:e,y:n});return this.cells[t.toIndex(r)]}},{key:"getRegion",value:function(t){return this.regions[t]}},{key:"getRegions",value:function(){return Object.values(this.regions)}},{key:"flood",value:function(t,e,n){if(!(t<0||t>=a||e<0||e>=a)){var r=this.getEntity(t,e);!r||r.blocked||r.region||(n.addEntity(r),r.region=n,this.flood(t-1,e,n),this.flood(t+1,e,n),this.flood(t,e+1,n),this.flood(t,e-1,n))}}},{key:"resetRegions",value:function(){this.regions={},this.lastRegionId=0;for(var t=0;t<this.cells.length;t+=1)this.cells[t].region=null}},{key:"rebuild",value:function(){var e=this,n=function(){return e.getEntities().findIndex(function(t){return!t.region&&!t.blocked})};this.resetRegions();for(var r=n();-1!==r;){this.lastRegionId+=1;var o=new u.default(this.id+"::"+this.lastRegionId);this.regions[o.id]=o;var i=t.toPosition(r);this.flood(i.x,i.y,o),r=n()}}}],[{key:"toLocalPos",value:function(t){var e=t.x,n=t.y;return{x:e%a,y:n%a}}},{key:"toPosition",value:function(t){return{x:t%a,y:Math.floor(t/a)}}},{key:"toIndex",value:function(t){var e=t.x;return t.y*a+e}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(4),a=(r=u)&&r.__esModule?r:{default:r};var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.zones=[],this.dirtyZones=[]}return i(t,[{key:"addZone",value:function(t,e){var n=new a.default(t,e);return this.zones.push(n),n}},{key:"addEntity",value:function(t){var e=this.getZone(t.x,t.y);if(!e){var n=Math.floor(t.x/u.ZONE_SIZE),r=Math.floor(t.y/u.ZONE_SIZE);console.log("Creating zone at {"+n+", "+r+"}"),e=this.addZone(n,r)}return this.dirtyZones.push(e),e.addEntity(t)}},{key:"getEntity",value:function(t,e){var n=this.getZone(t,e);return n?n.getEntity(t,e):null}},{key:"getRegion",value:function(t){var e=t.split("::"),n=o(e,1)[0];return this.zones.find(function(t){return t.id===n}).getRegion(t)}},{key:"rebuildDirtyZones",value:function(){for(var t=0;t<this.dirtyZones.length;t+=1)this.dirtyZones[t].rebuild();this.dirtyZones=[]}},{key:"getZone",value:function(t,e){var n=Math.floor(t/u.ZONE_SIZE),r=Math.floor(e/u.ZONE_SIZE);return this.zones.find(function(t){return t.worldX===n&&t.worldY===r})}},{key:"getZones",value:function(){return this.zones}},{key:"touch",value:function(t,e){var n=(this.getEntity(t,e)||{}).blocked;this.addEntity({x:t,y:e,blocked:!n})}}]),t}();e.default=l},function(t,e,n){"use strict";var r=u(n(5)),o=u(n(1)),i=u(n(0));function u(t){return t&&t.__esModule?t:{default:t}}var a=document.getElementById("canvas"),l=a.getContext("2d");l.translate(10,10);var s=new r.default;(0,o.default)(i.default).forEach(function(t){return s.addEntity(t)});var f=function(){l.clearRect(0,0,a.width,a.height),s.rebuildDirtyZones();for(var t=s.getZones(),e=[],n=0;n<t.length;n+=1)e=e.concat(t[n].getEntities());for(var r=0;r<e.length;r+=1){var o=e[r];l.fillStyle=o.blocked?"#333":s.getRegion(o.region.id).colour,l.fillRect(16*o.x,16*o.y,16,16)}for(var i=0;i<t.length;i+=1){var u=t[i].getBounds(),f=u.x,c=u.y,d=u.width,h=u.height;l.strokeStyle="blue",l.lineWidth="5",l.rect(16*f,16*c,16*d,16*h),l.stroke()}};a.onclick=function(t){var e=a.getBoundingClientRect(),n=function(t,e){return{x:Math.floor((t-10)/16),y:Math.floor((e-10)/16)}}(t.clientX-e.left,t.clientY-e.top),r=n.x,o=n.y;s.touch(r,o),f()},f()}]);
//# sourceMappingURL=main.487207e5.js.map